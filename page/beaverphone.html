<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>BeaverPhone</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      color-scheme: dark;
      --bg: #060608;
      --panel: #0f1018;
      --panel-glow: rgba(248, 148, 34, 0.12);
      --border: rgba(255, 255, 255, 0.08);
      --text-main: #ffffff;
      --text-muted: rgba(255, 255, 255, 0.64);
      --text-soft: rgba(255, 255, 255, 0.42);
      --accent: #f89422;
      --accent-strong: #ff9f33;
      --font: "Inter", "Segoe UI", sans-serif;
      --shadow: 0 28px 40px rgba(0, 0, 0, 0.45);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      font-family: var(--font);
      background: radial-gradient(circle at 15% 20%, rgba(248, 148, 34, 0.12), transparent 55%),
        radial-gradient(circle at 85% 10%, rgba(248, 148, 34, 0.08), transparent 50%),
        var(--bg);
      color: var(--text-main);
      padding: clamp(2.5rem, 5vw + 1rem, 3.5rem) clamp(1.25rem, 4vw, 2.5rem);
    }

    .beaverphone {
      width: min(1200px, 100%);
      display: grid;
      gap: 2.6rem;
    }

    header {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .header-title {
      display: inline-flex;
      align-items: center;
      gap: 0.85rem;
    }

    header .eyebrow {
      letter-spacing: 0.2em;
      text-transform: uppercase;
      font-size: clamp(1.6rem, 4vw, 2.3rem);
      font-weight: 700;
      color: var(--accent);
    }

    .menu-return {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 48px;
      height: 48px;
      border-radius: 16px;
      border: 1px solid rgba(255, 255, 255, 0.12);
      background: rgba(255, 255, 255, 0.04);
      color: var(--text-muted);
      transition: color 160ms ease, border 160ms ease, background 160ms ease, transform 160ms ease;
    }

    .menu-return:hover,
    .menu-return:focus-visible {
      color: var(--accent);
      border-color: var(--accent);
      background: rgba(248, 148, 34, 0.14);
      transform: translateY(-2px);
      outline: none;
    }

    .menu-return svg {
      width: 24px;
      height: 24px;
      stroke-width: 1.8;
    }

    .app {
      display: grid;
      gap: 2.4rem;
      grid-template-columns: repeat(2, minmax(0, 1fr));
    }

    .panel {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 26px;
      padding: 2.2rem;
      box-shadow: var(--shadow);
      position: relative;
      overflow: hidden;
      isolation: isolate;
    }

    .panel::after {
      content: "";
      position: absolute;
      inset: 0;
      background: var(--panel-glow);
      opacity: 0;
      transition: opacity 180ms ease;
      pointer-events: none;
      z-index: -1;
    }

    .panel:focus-within::after,
    .panel:hover::after {
      opacity: 1;
    }

    .dialpad-header {
      display: flex;
      justify-content: space-between;
      gap: 1rem;
      align-items: center;
      margin-bottom: 1.8rem;
    }

    .status-cluster {
      display: inline-flex;
      align-items: center;
      gap: 0.75rem;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .dialpad-header h2 {
      font-size: 1.35rem;
      font-weight: 600;
    }

    .status-pill {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.35rem 0.9rem;
      border-radius: 999px;
      border: 1px solid var(--border);
      font-size: 0.8rem;
      color: var(--text-muted);
      background: rgba(255, 255, 255, 0.02);
      transition: border 160ms ease, color 160ms ease;
    }

    .status-pill .status-text {
      line-height: 1;
    }

    .ws-indicator {
      display: inline-flex;
      align-items: center;
      gap: 0.45rem;
      padding: 0.35rem 0.75rem;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.12);
      font-size: 0.78rem;
      color: var(--text-muted);
      background: rgba(255, 255, 255, 0.02);
      transition: border 160ms ease, color 160ms ease, background 160ms ease;
    }

    .ws-indicator .ws-icon {
      display: inline-flex;
      width: 18px;
      height: 18px;
    }

    .ws-indicator .ws-icon svg {
      width: 100%;
      height: 100%;
    }

    @keyframes wsPulse {
      0% {
        transform: translateX(-2px);
        opacity: 0.6;
      }
      50% {
        transform: translateX(2px);
        opacity: 1;
      }
      100% {
        transform: translateX(-2px);
        opacity: 0.6;
      }
    }

    .ws-indicator[data-state="connecting"] .ws-icon {
      animation: wsPulse 1.4s ease-in-out infinite;
    }

    .ws-indicator[data-state="connected"] {
      border-color: var(--accent);
      color: var(--accent);
      background: rgba(248, 148, 34, 0.12);
    }

    .ws-indicator[data-state="disconnected"] {
      border-color: rgba(255, 95, 95, 0.6);
      color: #ff8a8a;
      background: rgba(255, 95, 95, 0.12);
    }

    .status-pill[data-active="true"] {
      border-color: var(--accent);
      color: var(--accent);
    }

    .composer {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.07);
      border-radius: 20px;
      padding: 1.2rem 1.4rem;
      display: flex;
      flex-direction: column;
      gap: 0.45rem;
      margin-bottom: 1.6rem;
    }

    .composer label {
      font-size: 0.76rem;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: var(--text-soft);
      font-weight: 600;
    }

    .composer input {
      background: transparent;
      border: none;
      color: inherit;
      font-size: clamp(1.8rem, 4vw, 2.4rem);
      font-weight: 600;
      letter-spacing: 0.1em;
      outline: none;
      width: 100%;
    }

    .composer input::placeholder {
      color: rgba(255, 255, 255, 0.22);
    }

    .dialpad-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 1rem;
    }

    .dialpad-key {
      appearance: none;
      border: 1px solid rgba(255, 255, 255, 0.05);
      border-radius: 22px;
      background: rgba(255, 255, 255, 0.03);
      color: inherit;
      padding: 1.1rem 0;
      font-size: 1.75rem;
      font-weight: 600;
      text-align: center;
      cursor: pointer;
      transition: transform 120ms ease, border 160ms ease, box-shadow 160ms ease;
      position: relative;
    }

    .dialpad-key span {
      display: block;
      font-size: 0.75rem;
      font-weight: 500;
      letter-spacing: 0.25em;
      color: var(--text-soft);
      margin-top: 0.35rem;
    }

    .dialpad-key:active,
    .dialpad-key:hover {
      transform: translateY(-2px);
      border-color: var(--accent-strong);
      box-shadow: 0 10px 20px rgba(248, 148, 34, 0.18);
    }

    .dialpad-actions,
    .dialpad-secondary {
      margin-top: 1.6rem;
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 1rem;
      align-items: center;
    }

    .dialpad-secondary {
      margin-top: 0.75rem;
    }

    .pill-btn {
      appearance: none;
      border: 1px solid rgba(255, 255, 255, 0.08);
      background: rgba(255, 255, 255, 0.02);
      color: var(--text-muted);
      font-weight: 600;
      padding: 0.9rem 1.2rem;
      border-radius: 999px;
      cursor: pointer;
      transition: border 160ms ease, color 160ms ease, background 160ms ease, box-shadow 160ms ease;
      display: inline-flex;
      justify-content: center;
      align-items: center;
      gap: 0.65rem;
    }

    .btn-icon {
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }

    .pill-btn .btn-icon svg {
      width: 20px;
      height: 20px;
      stroke-width: 1.8;
    }

    .pill-btn[data-active="true"] {
      border-color: var(--accent);
      color: var(--accent);
      background: rgba(248, 148, 34, 0.12);
      box-shadow: 0 10px 18px rgba(248, 148, 34, 0.25);
    }

    .pill-btn:disabled {
      opacity: 0.45;
      cursor: not-allowed;
    }

    .call-btn {
      border-radius: 26px;
      font-size: 1.1rem;
      padding-block: 1.1rem;
      background: linear-gradient(135deg, rgba(248, 148, 34, 0.95), rgba(248, 148, 34, 0.65));
      color: #121212;
      border: none;
      box-shadow: 0 18px 32px rgba(248, 148, 34, 0.35);
      position: relative;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.12em;
    }

    .call-btn[data-active="true"] {
      background: linear-gradient(135deg, rgba(248, 34, 34, 0.95), rgba(248, 34, 34, 0.7));
      color: #fff;
      box-shadow: 0 18px 32px rgba(248, 34, 34, 0.35);
    }

    .subtext {
      font-size: 0.95rem;
      color: var(--text-soft);
      margin-top: 0.6rem;
      text-align: center;
    }

    .extensions {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }

    .extensions header {
      display: flex;
      flex-direction: column;
      gap: 0.6rem;
    }

    .extensions header h2 {
      font-size: 1.35rem;
      font-weight: 600;
    }

    .extensions header p {
      color: var(--text-muted);
      font-size: 0.95rem;
    }

    .extension-list {
      display: grid;
      gap: 1rem;
    }

    .extension-card {
      border: 1px solid rgba(255, 255, 255, 0.06);
      border-radius: 20px;
      background: rgba(255, 255, 255, 0.03);
      padding: 1.35rem 1.4rem;
      display: grid;
      grid-template-columns: auto 1fr auto;
      align-items: center;
      gap: 1.4rem;
      cursor: pointer;
      transition: transform 160ms ease, border 160ms ease, box-shadow 160ms ease;
    }

    .extension-card:hover {
      transform: translateY(-3px);
      border-color: var(--accent);
      box-shadow: 0 12px 26px rgba(248, 148, 34, 0.18);
    }

    .extension-card .avatar {
      width: 56px;
      height: 56px;
      border-radius: 18px;
      background: rgba(248, 148, 34, 0.16);
      color: var(--accent);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      letter-spacing: 0.06em;
      overflow: hidden;
      position: relative;
    }

    .extension-card .avatar img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      padding: 0.4rem;
      box-sizing: border-box;
    }

    .extension-card .avatar--fallback {
      background: rgba(255, 255, 255, 0.08);
      color: var(--text-main);
    }

    .extension-card h3 {
      font-size: 1.05rem;
      font-weight: 600;
      margin-bottom: 0.2rem;
    }

    .extension-card .subtitle {
      color: var(--text-muted);
      font-size: 0.9rem;
    }

    .extension-card .details {
      color: var(--text-soft);
      font-size: 0.82rem;
      margin-top: 0.4rem;
    }

    .extension-card .extension {
      font-weight: 700;
      color: var(--accent);
      letter-spacing: 0.1em;
    }

    .empty-hint {
      text-align: center;
      color: var(--text-soft);
      margin-top: 0.8rem;
      font-size: 0.9rem;
    }

    @media (max-width: 960px) {
      body {
        padding: 2.4rem 1.6rem;
      }

      .app {
        grid-template-columns: 1fr;
      }

      header {
        justify-content: space-between;
      }
    }

    @media (max-width: 720px) {
      body {
        padding: 1.9rem 1.25rem;
      }

      .beaverphone {
        gap: 2.1rem;
      }

      header {
        flex-direction: column;
        align-items: stretch;
      }

      .header-title {
        width: 100%;
        justify-content: space-between;
      }

      .menu-return {
        align-self: flex-start;
      }

      .dialpad-actions,
      .dialpad-secondary {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }

      .dialpad-secondary {
        margin-top: 1.2rem;
      }
    }

    @media (max-width: 540px) {
      .composer {
        padding: 1rem 1.1rem;
      }

      .dialpad-actions,
      .dialpad-secondary {
        grid-template-columns: 1fr;
      }

      .dialpad-grid {
        gap: 0.75rem;
      }

      .extension-card {
        grid-template-columns: 1fr;
        text-align: center;
      }

      .extension-card .avatar {
        margin: 0 auto;
      }

      .extension-card .extension {
        justify-self: center;
      }
    }
  </style>
</head>
<body>
  <div class="beaverphone">
    <header>
      <div class="header-title">
        <a class="menu-return" href="menu.html" aria-label="Return to menu">
          <span class="btn-icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round"
              stroke-linejoin="round">
              <path d="M3 9l9-7 9 7"></path>
              <path d="M9 22V12h6v10"></path>
              <path d="M21 10v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V10"></path>
            </svg>
          </span>
        </a>
        <span class="eyebrow">BeaverPhone</span>
      </div>
    </header>

    <div class="app">
      <section class="panel" aria-labelledby="dialpad-heading">
        <div class="dialpad-header">
          <h2 id="dialpad-heading">Dialpad</h2>
          <div class="status-cluster">
            <span class="ws-indicator" id="ws-indicator" data-state="connecting">
              <span class="ws-icon" aria-hidden="true">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                  stroke-linejoin="round">
                  <path d="M12 12h.01"></path>
                  <path d="M16 12h.01"></path>
                  <path d="m17 7 5 5-5 5"></path>
                  <path d="m7 7-5 5 5 5"></path>
                  <path d="M8 12h.01"></path>
                </svg>
              </span>
              <span class="ws-label">Connecting…</span>
            </span>
            <span class="status-pill" id="status-pill" data-active="false">
              <span class="status-text">Ready</span>
            </span>
          </div>
        </div>

        <div class="composer">
          <label for="composer-input">Composer</label>
          <input id="composer-input" type="text" inputmode="tel" autocomplete="off" placeholder="Tap numbers to dial"
            aria-live="polite" />
        </div>

        <div class="dialpad-grid" id="dialpad"></div>

        <div class="dialpad-actions">
          <button type="button" class="pill-btn" id="erase-btn">
            <span class="btn-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                stroke-linejoin="round">
                <path
                  d="M13 9a1 1 0 0 1-1-1V5.061a1 1 0 0 0-1.811-.75l-6.835 6.836a1.207 1.207 0 0 0 0 1.707l6.835 6.835a1 1 0 0 0 1.811-.75V16a1 1 0 0 1 1-1h2a1 1 0 0 0 1-1v-4a1 1 0 0 0-1-1z">
                </path>
                <path d="M20 9v6"></path>
              </svg>
            </span>
            <span class="btn-label">Erase</span>
          </button>
          <button type="button" class="pill-btn call-btn" id="call-btn">
            <span class="btn-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round"
                stroke-linejoin="round">
                <path
                  d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.82 12.82 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.82 12.82 0 0 0 2.81.7A2 2 0 0 1 22 16.92z">
                </path>
              </svg>
            </span>
            <span class="btn-label">Call</span>
          </button>
          <button type="button" class="pill-btn" id="speaker-btn">
            <span class="btn-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round"
                stroke-linejoin="round">
                <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                <path d="M19.07 4.93a10 10 0 0 1 0 14.14"></path>
                <path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path>
              </svg>
            </span>
            <span class="btn-label">Speaker</span>
          </button>
        </div>

        <div class="dialpad-secondary">
          <button type="button" class="pill-btn" id="hold-btn" disabled>
            <span class="btn-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round"
                stroke-linejoin="round">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="10" x2="10" y1="15" y2="9"></line>
                <line x1="14" x2="14" y1="15" y2="9"></line>
              </svg>
            </span>
            <span class="btn-label">Hold</span>
          </button>
          <button type="button" class="pill-btn" id="clear-btn">Clear</button>
          <span></span>
        </div>

        <p class="subtext" id="helper-text">Tap digits or choose a contact to start dialing.</p>
      </section>

      <aside class="panel extensions" aria-labelledby="extension-heading">
        <header>
          <h2 id="extension-heading">Extensions</h2>
          <p>Tap a contact to call automatically.</p>
        </header>
        <div class="extension-list" id="extension-list"></div>
      </aside>
    </div>
  </div>

  <script type="module">
  const BEAVERPHONE_DIALPAD_EVENT_KEY = "beaverphone:dialpad";

  const currentDialpadState = {
    dialedNumber: "",
    isOnCall: false,
    isOnHold: false,
    isSpeakerEnabled: false,
  };

  const beaverPhoneConfig = {
    dialpad: [
      { label: "1" }, { label: "2", subtext: "ABC" }, { label: "3", subtext: "DEF" },
      { label: "4" }, { label: "5", subtext: "JKL" }, { label: "6", subtext: "MNO" },
      { label: "7", subtext: "PQRS" }, { label: "8", subtext: "TUV" }, { label: "9", subtext: "WXYZ" },
      { label: "*" }, { label: "0", subtext: "+" }, { label: "#" },
    ],
    contacts: [
      { name: "Ontario Provincial Police", subtitle: "Internal line", details: "Office 101", extension: "1201", image: "../contact/Police.png" },
      { name: "SPCA Niagara", subtitle: "Paws Law", details: "Office 3434", extension: "3434", image: "../contact/SPCA.png" },
      { name: "Mom", subtitle: "Mom", details: "Complaints Office", extension: "22", image: null },
      { name: "Services Ontario", subtitle: "Government of Ontario", details: "Desktop *1345", extension: "1345", image: "../contact/ontario.svg" },
    ],
    dialpadEventKey: BEAVERPHONE_DIALPAD_EVENT_KEY,
  };

  const dialpadEl = document.getElementById("dialpad");
  const composerInput = document.getElementById("composer-input");
  const statusPill = document.getElementById("status-pill");
  const helperText = document.getElementById("helper-text");
  const callBtn = document.getElementById("call-btn");
  const holdBtn = document.getElementById("hold-btn");
  const speakerBtn = document.getElementById("speaker-btn");
  const eraseBtn = document.getElementById("erase-btn");
  const clearBtn = document.getElementById("clear-btn");
  const extensionList = document.getElementById("extension-list");

  const statusText = statusPill.querySelector(".status-text");
  const wsIndicator = document.getElementById("ws-indicator");
  const wsLabel = wsIndicator.querySelector(".ws-label");
  const callBtnLabel = callBtn.querySelector(".btn-label");
  const holdBtnLabel = holdBtn.querySelector(".btn-label");
  const speakerBtnLabel = speakerBtn.querySelector(".btn-label");

  const setWsIndicator = (state, label) => {
    if (!wsIndicator || !wsLabel) return;
    wsIndicator.dataset.state = state;
    wsLabel.textContent = label;
  };

  // 🔹 Dispatcher d’événements enrichi avec "action"
  const dispatchDialpadEvent = (action, number = undefined) => {
    const event = new CustomEvent(beaverPhoneConfig.dialpadEventKey, {
      detail: { action, number },
    });
    window.dispatchEvent(event);
  };

  const updateUI = () => {
    composerInput.value = currentDialpadState.dialedNumber;
    callBtn.dataset.active = currentDialpadState.isOnCall;
    callBtnLabel.textContent = currentDialpadState.isOnCall ? "End" : "Call";
    holdBtn.disabled = !currentDialpadState.isOnCall;
    holdBtn.dataset.active = currentDialpadState.isOnHold;
    holdBtnLabel.textContent = currentDialpadState.isOnHold ? "Resume" : "Hold";
    speakerBtn.dataset.active = currentDialpadState.isSpeakerEnabled;
    speakerBtnLabel.textContent = currentDialpadState.isSpeakerEnabled ? "Mute" : "Speaker";

    if (currentDialpadState.isOnCall) {
      statusPill.dataset.active = "true";
      statusText.textContent = currentDialpadState.isOnHold ? "On Hold" : "On Call";
      helperText.textContent = currentDialpadState.isOnHold
        ? "Call is on hold. Tap Hold to resume."
        : "You are connected. Use Hold or Speaker as needed.";
    } else if (currentDialpadState.dialedNumber.length > 0) {
      statusPill.dataset.active = "false";
      statusText.textContent = "Ready";
      helperText.textContent = "Press Call to connect or erase to edit the number.";
    } else {
      statusPill.dataset.active = "false";
      statusText.textContent = "Ready";
      helperText.textContent = "Tap digits or choose a contact to start dialing.";
    }
  };

  // 🔹 Ajout des touches numériques
  const appendDigit = (digit) => {
    currentDialpadState.dialedNumber += digit;
    dispatchDialpadEvent("dtmf", digit);
    updateUI();
  };

  const eraseDigit = () => {
    if (!currentDialpadState.dialedNumber) return;
    currentDialpadState.dialedNumber = currentDialpadState.dialedNumber.slice(0, -1);
    updateUI();
  };

  const resetDialer = () => {
    currentDialpadState.dialedNumber = "";
    currentDialpadState.isOnCall = false;
    currentDialpadState.isOnHold = false;
    updateUI();
  };

  beaverPhoneConfig.dialpad.forEach((item) => {
    const btn = document.createElement("button");
    btn.type = "button";
    btn.className = "dialpad-key";
    btn.textContent = item.label;
    if (item.subtext) {
      const sub = document.createElement("span");
      sub.textContent = item.subtext;
      btn.appendChild(sub);
    }
    btn.addEventListener("click", () => appendDigit(item.label));
    dialpadEl.appendChild(btn);
  });

  // 🔹 Bouton Call → envoie "dial" ou "hangup"
  callBtn.addEventListener("click", () => {
    if (!currentDialpadState.isOnCall && currentDialpadState.dialedNumber.length === 0) {
      helperText.textContent = "Enter a number or choose a contact first.";
      return;
    }
    currentDialpadState.isOnCall = !currentDialpadState.isOnCall;

    if (currentDialpadState.isOnCall) {
      dispatchDialpadEvent("dial", currentDialpadState.dialedNumber);
    } else {
      dispatchDialpadEvent("hangup");
    }

    updateUI();
  });

  holdBtn.addEventListener("click", () => {
    if (!currentDialpadState.isOnCall) return;
    currentDialpadState.isOnHold = !currentDialpadState.isOnHold;
    updateUI();
  });

  speakerBtn.addEventListener("click", () => {
    currentDialpadState.isSpeakerEnabled = !currentDialpadState.isSpeakerEnabled;
    updateUI();
  });

  eraseBtn.addEventListener("click", () => {
    if (currentDialpadState.dialedNumber.length === 0) {
      helperText.textContent = "Nothing to erase.";
      return;
    }
    eraseDigit();
  });

  clearBtn.addEventListener("click", () => {
    resetDialer();
    dispatchDialpadEvent("clear");
  });

  composerInput.addEventListener("input", (event) => {
    const { value } = event.target;
    currentDialpadState.dialedNumber = value.replace(/[^0-9*#]/g, "");
    updateUI();
  });

  composerInput.addEventListener("keydown", (event) => {
    if (event.key === "Enter") {
      callBtn.click();
    } else if (event.key === "Backspace" && event.metaKey) {
      resetDialer();
      dispatchDialpadEvent("clear");
    }
  });

  window.addEventListener("beaverphone:ws-status", (event) => {
    const { status } = event.detail || {};

    switch (status) {
      case "connected":
        setWsIndicator("connected", "Connected");
        break;
      case "disconnected":
        setWsIndicator("disconnected", "Offline");
        break;
      case "connecting":
      default:
        setWsIndicator("connecting", "Connecting…");
        break;
    }
  });

  // 🔹 Extensions → appellent direct avec "dial"
  beaverPhoneConfig.contacts.forEach((contact) => {
    const card = document.createElement("article");
    card.className = "extension-card";

    const avatar = document.createElement("div");
    avatar.className = "avatar";
    avatar.setAttribute("aria-hidden", "true");

    if (contact.image) {
      const img = document.createElement("img");
      img.src = contact.image;
      img.alt = `${contact.name} avatar`;
      img.addEventListener("error", () => {
        img.remove();
        avatar.classList.add("avatar--fallback");
        avatar.textContent = contact.name.slice(0, 1).toUpperCase();
      });
      avatar.appendChild(img);
    } else {
      avatar.classList.add("avatar--fallback");
      avatar.textContent = contact.name.slice(0, 1).toUpperCase();
    }

    const info = document.createElement("div");
    const nameEl = document.createElement("h3");
    nameEl.textContent = contact.name;
    const subtitleEl = document.createElement("div");
    subtitleEl.className = "subtitle";
    subtitleEl.textContent = contact.subtitle;
    const detailsEl = document.createElement("div");
    detailsEl.className = "details";
    detailsEl.textContent = contact.details;
    info.appendChild(nameEl);
    info.appendChild(subtitleEl);
    info.appendChild(detailsEl);

    const extension = document.createElement("div");
    extension.className = "extension";
    extension.textContent = `Ext. ${contact.extension}`;

    card.appendChild(avatar);
    card.appendChild(info);
    card.appendChild(extension);

    card.addEventListener("click", () => {
      currentDialpadState.dialedNumber = contact.extension;
      currentDialpadState.isOnCall = true;
      currentDialpadState.isOnHold = false;
      dispatchDialpadEvent("dial", contact.extension);
      updateUI();
    });
    extensionList.appendChild(card);
  });

  if (beaverPhoneConfig.contacts.length === 0) {
    const emptyState = document.createElement("p");
    emptyState.className = "empty-hint";
    emptyState.textContent = "No saved extensions yet.";
    extensionList.appendChild(emptyState);
  }

  updateUI();
</script>
