<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Beavertask - Calendar</title>
    <style>
      :root {
        --bg-primary: #000000;
        --bg-secondary: #0a0a0a;
        --text-primary: #ffffff;
        --text-secondary: #999999;
        --text-muted: #666666;
        --accent: #f89422;
        --accent-dim: rgba(248, 148, 34, 0.2);
        --border: #1a1a1a;
        --card-bg: #0f0f0f;
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      html,
      body {
        width: 100%;
        height: 100%;
        overflow: hidden;
        background: var(--bg-primary);
        color: var(--text-primary);
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      }

      .app-container {
        display: flex;
        height: 100vh;
        width: 100vw;
      }

      .sidebar {
        width: 60px;
        background: var(--bg-secondary);
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 20px 0;
        gap: 30px;
        border-right: 1px solid var(--border);
      }

      .sidebar-icon {
        width: 24px;
        height: 24px;
        cursor: pointer;
        opacity: 0.6;
        transition: opacity 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .sidebar-icon:hover {
        opacity: 1;
      }

      .sidebar-icon.active {
        opacity: 1;
        color: var(--accent);
      }

      .main-content {
        flex: 1;
        display: flex;
        overflow: hidden;
      }

      .calendar-section {
        flex: 1;
        display: flex;
        flex-direction: column;
        padding: 40px;
        max-width: 650px;
      }

      .calendar-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 40px;
      }

      .month-display {
        font-size: 24px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 2px;
      }

      .header-controls {
        display: flex;
        gap: 10px;
        align-items: center;
      }

      .icon-btn {
        background: transparent;
        border: none;
        color: var(--text-primary);
        cursor: pointer;
        padding: 8px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background 0.2s;
      }

      .icon-btn:hover {
        background: rgba(255, 255, 255, 0.1);
      }

      .current-day-badge {
        background: var(--text-primary);
        color: var(--bg-primary);
        border-radius: 8px;
        padding: 6px 12px;
        font-size: 14px;
        font-weight: 600;
      }

      .weekdays {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 8px;
        margin-bottom: 8px;
      }

      .weekday {
        text-align: center;
        font-size: 11px;
        font-weight: 600;
        color: var(--text-secondary);
        text-transform: uppercase;
        padding: 8px 0;
        letter-spacing: 1px;
      }

      .weekday.dim {
        color: var(--accent);
      }

      .calendar-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 8px;
        flex: 1;
      }

      .calendar-cell {
        background: transparent;
        border: 1px solid transparent;
        border-radius: 12px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.2s;
        position: relative;
        min-height: 60px;
        padding: 8px;
      }

      .calendar-cell:hover {
        background: rgba(255, 255, 255, 0.05);
      }

      .calendar-cell.inactive {
        opacity: 0.3;
      }

      .calendar-cell.today {
        border: 2px solid var(--accent);
      }

      .calendar-cell.selected {
        background: transparent;
        position: relative;
      }

      .calendar-cell.selected::after {
        content: '';
        position: absolute;
        bottom: 8px;
        left: 50%;
        transform: translateX(-50%);
        width: 32px;
        height: 3px;
        background: var(--text-primary);
        border-radius: 2px;
      }

      .calendar-cell.has-events::before {
        content: '';
        position: absolute;
        top: 8px;
        right: 8px;
        width: 4px;
        height: 4px;
        background: var(--accent);
        border-radius: 50%;
      }

      .cell-date {
        font-size: 16px;
        font-weight: 500;
        color: var(--text-primary);
      }

      .details-panel {
        flex: 1;
        background: var(--bg-secondary);
        padding: 40px;
        display: flex;
        flex-direction: column;
        border-left: 1px solid var(--border);
        overflow-y: auto;
      }

      .details-header {
        font-size: 14px;
        color: var(--text-secondary);
        margin-bottom: 30px;
      }

      .details-content {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }

      .empty-state {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 20px;
        text-align: center;
      }

      .empty-icon {
        font-size: 48px;
        opacity: 0.5;
      }

      .empty-text {
        color: var(--text-secondary);
        font-size: 14px;
      }

      .event-input {
        width: 100%;
        background: var(--card-bg);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 16px 20px;
        color: var(--text-primary);
        font-size: 15px;
        margin-top: auto;
        transition: border-color 0.2s;
      }

      .event-input:focus {
        outline: none;
        border-color: var(--accent);
      }

      .event-input::placeholder {
        color: var(--text-muted);
      }

      .fab {
        position: fixed;
        bottom: 40px;
        right: 40px;
        width: 56px;
        height: 56px;
        background: var(--text-secondary);
        border: none;
        border-radius: 50%;
        color: var(--bg-primary);
        font-size: 24px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        transition: all 0.2s;
      }

      .fab:hover {
        background: var(--text-primary);
        transform: scale(1.1);
      }

      .task-list {
        display: flex;
        flex-direction: column;
        gap: 12px;
        margin-bottom: 20px;
      }

      .task-item {
        background: var(--card-bg);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 16px;
        display: flex;
        align-items: center;
        gap: 12px;
        transition: background 0.2s;
      }

      .task-item:hover {
        background: rgba(255, 255, 255, 0.05);
      }

      .task-checkbox {
        width: 20px;
        height: 20px;
        border: 2px solid var(--text-secondary);
        border-radius: 50%;
        cursor: pointer;
        transition: all 0.2s;
        flex-shrink: 0;
      }

      .task-checkbox.completed {
        background: var(--accent);
        border-color: var(--accent);
        position: relative;
      }

      .task-checkbox.completed::after {
        content: 'âœ“';
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: var(--bg-primary);
        font-size: 12px;
        font-weight: bold;
      }

      .task-info {
        flex: 1;
      }

      .task-title {
        font-size: 15px;
        color: var(--text-primary);
        margin-bottom: 4px;
      }

      .task-meta {
        font-size: 13px;
        color: var(--text-secondary);
      }

      .task-actions {
        display: flex;
        gap: 8px;
      }

      .task-action-btn {
        background: transparent;
        border: none;
        color: var(--text-secondary);
        cursor: pointer;
        padding: 4px;
        font-size: 14px;
        transition: color 0.2s;
      }

      .task-action-btn:hover {
        color: var(--text-primary);
      }

      .task-action-btn.delete:hover {
        color: #ff4444;
      }

      @media (max-width: 1024px) {
        .sidebar {
          width: 50px;
          padding: 15px 0;
        }

        .calendar-section {
          padding: 20px;
        }

        .details-panel {
          padding: 20px;
        }
      }

      @media (max-width: 768px) {
        .app-container {
          flex-direction: column;
        }

        .sidebar {
          width: 100%;
          height: 50px;
          flex-direction: row;
          padding: 0 20px;
          border-right: none;
          border-bottom: 1px solid var(--border);
        }

        .main-content {
          flex-direction: column;
        }

        .calendar-section {
          max-width: 100%;
          padding: 20px;
        }

        .details-panel {
          border-left: none;
          border-top: 1px solid var(--border);
        }
      }
    </style>
  </head>
  <body>
    <div class="app-container">
      <aside class="sidebar">
        <div class="sidebar-icon" id="menu-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="3" y1="12" x2="21" y2="12"></line>
            <line x1="3" y1="6" x2="21" y2="6"></line>
            <line x1="3" y1="18" x2="21" y2="18"></line>
          </svg>
        </div>
        <div class="sidebar-icon active" id="calendar-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
            <line x1="16" y1="2" x2="16" y2="6"></line>
            <line x1="8" y1="2" x2="8" y2="6"></line>
            <line x1="3" y1="10" x2="21" y2="10"></line>
          </svg>
        </div>
      </aside>

      <div class="main-content">
        <section class="calendar-section">
          <div class="calendar-header">
            <button class="icon-btn" id="prev-month">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="15 18 9 12 15 6"></polyline>
              </svg>
            </button>
            <div class="month-display" id="month-display">OCT.</div>
            <button class="icon-btn" id="next-month">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="9 18 15 12 9 6"></polyline>
              </svg>
            </button>
            <div class="header-controls">
              <button class="icon-btn" id="search-btn">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="11" cy="11" r="8"></circle>
                  <path d="m21 21-4.35-4.35"></path>
                </svg>
              </button>
              <div class="current-day-badge" id="current-day-badge">14</div>
            </div>
          </div>

          <div class="weekdays">
            <div class="weekday dim">SUN</div>
            <div class="weekday">MON</div>
            <div class="weekday">TUE</div>
            <div class="weekday">WED</div>
            <div class="weekday">THU</div>
            <div class="weekday">FRI</div>
            <div class="weekday">SAT</div>
          </div>

          <div class="calendar-grid" id="calendar-grid"></div>
        </section>

        <section class="details-panel">
          <div class="details-header" id="details-header">14 Oct.</div>
          
          <div class="details-content" id="details-content">
            <div class="empty-state">
              <div class="empty-icon">â˜º</div>
              <div class="empty-text">Appuyez pour ajouter un autocollant Ã  cette journÃ©e.</div>
            </div>
          </div>

          <input 
            type="text" 
            class="event-input" 
            id="event-input" 
            placeholder="Ajout Ã©vÃ©n. le 14 oct."
          />
        </section>
      </div>

      <button class="fab" id="add-btn">
        <span>+</span>
      </button>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <script>
      const STORAGE_KEY = "beavertask_tasks";
      
      const state = {
        tasks: [],
        currentYear: new Date().getFullYear(),
        currentMonth: new Date().getMonth(),
        selectedDate: null,
      };

      const monthNames = ["JAN.", "FEB.", "MAR.", "APR.", "MAY", "JUN.", "JUL.", "AUG.", "SEP.", "OCT.", "NOV.", "DEC."];
      const monthNamesFull = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];

      const loadTasks = () => {
        try {
          const stored = localStorage.getItem(STORAGE_KEY);
          return stored ? JSON.parse(stored) : [];
        } catch (error) {
          console.error("Failed to load tasks:", error);
          return [];
        }
      };

      const saveTasks = () => {
        try {
          localStorage.setItem(STORAGE_KEY, JSON.stringify(state.tasks));
        } catch (error) {
          console.error("Failed to save tasks:", error);
        }
      };

      const normalizeTask = (task) => {
        if (!task || typeof task !== "object") {
          return null;
        }

        const createdAt = typeof task.createdAt === "string" ? task.createdAt : new Date().toISOString();
        const updatedAt = typeof task.updatedAt === "string" ? task.updatedAt : createdAt;

        return {
          id: task.id || Date.now().toString() + Math.random().toString(36).substr(2, 9),
          title: task.title ?? "",
          description: task.description ?? "",
          dueDate: typeof task.dueDate === "string" && task.dueDate ? task.dueDate : null,
          tag: task.tag ?? "",
          completed: Boolean(task.completed),
          createdAt,
          updatedAt,
        };
      };

      const addTask = (taskInput) => {
        const created = normalizeTask({
          ...taskInput,
          createdAt: new Date().toISOString(),
          updatedAt: new Date().toISOString(),
        });
        
        if (created) {
          state.tasks.push(created);
          saveTasks();
          renderCalendar();
          renderDetails();
        }
      };

      const updateTask = (id, updates) => {
        const index = state.tasks.findIndex((task) => task.id === id);
        if (index >= 0) {
          state.tasks[index] = {
            ...state.tasks[index],
            ...updates,
            updatedAt: new Date().toISOString(),
          };
          saveTasks();
          renderCalendar();
          renderDetails();
        }
      };

      const deleteTask = (id) => {
        state.tasks = state.tasks.filter((task) => task.id !== id);
        saveTasks();
        renderCalendar();
        renderDetails();
      };

      const getDateKey = (date) => {
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const day = String(date.getDate()).padStart(2, '0');
        return `${year}-${month}-${day}`;
      };

      const renderCalendar = () => {
        const grid = document.getElementById('calendar-grid');
        const monthDisplay = document.getElementById('month-display');
        
        monthDisplay.textContent = monthNames[state.currentMonth];
        
        grid.innerHTML = '';
        
        const firstDay = new Date(state.currentYear, state.currentMonth, 1);
        const lastDay = new Date(state.currentYear, state.currentMonth + 1, 0);
        const startDay = firstDay.getDay();
        const totalDays = lastDay.getDate();
        
        const today = new Date();
        const todayKey = getDateKey(today);
        
        const taskMap = state.tasks.reduce((map, task) => {
          if (task.dueDate) {
            if (!map.has(task.dueDate)) {
              map.set(task.dueDate, []);
            }
            map.get(task.dueDate).push(task);
          }
          return map;
        }, new Map());
        
        for (let i = 0; i < startDay; i++) {
          const prevMonthDay = new Date(state.currentYear, state.currentMonth, -startDay + i + 1);
          const cell = createCalendarCell(prevMonthDay, true, taskMap);
          grid.appendChild(cell);
        }
        
        for (let day = 1; day <= totalDays; day++) {
          const date = new Date(state.currentYear, state.currentMonth, day);
          const cell = createCalendarCell(date, false, taskMap);
          grid.appendChild(cell);
        }
        
        const cellsCount = grid.children.length;
        const remainingCells = Math.ceil(cellsCount / 7) * 7 - cellsCount;
        for (let i = 1; i <= remainingCells; i++) {
          const nextMonthDay = new Date(state.currentYear, state.currentMonth + 1, i);
          const cell = createCalendarCell(nextMonthDay, true, taskMap);
          grid.appendChild(cell);
        }
      };

      const createCalendarCell = (date, inactive, taskMap) => {
        const cell = document.createElement('div');
        cell.className = 'calendar-cell';
        
        const dateKey = getDateKey(date);
        const today = new Date();
        const todayKey = getDateKey(today);
        
        if (inactive) {
          cell.classList.add('inactive');
        }
        
        if (dateKey === todayKey) {
          cell.classList.add('today');
        }
        
        if (state.selectedDate && getDateKey(state.selectedDate) === dateKey) {
          cell.classList.add('selected');
        }
        
        if (taskMap.has(dateKey)) {
          cell.classList.add('has-events');
        }
        
        const dateSpan = document.createElement('span');
        dateSpan.className = 'cell-date';
        dateSpan.textContent = date.getDate();
        cell.appendChild(dateSpan);
        
        cell.addEventListener('click', () => {
          state.selectedDate = date;
          renderCalendar();
          renderDetails();
        });
        
        return cell;
      };

      const renderDetails = () => {
        const detailsHeader = document.getElementById('details-header');
        const detailsContent = document.getElementById('details-content');
        const eventInput = document.getElementById('event-input');
        
        if (!state.selectedDate) {
          state.selectedDate = new Date();
        }
        
        const dateKey = getDateKey(state.selectedDate);
        const day = state.selectedDate.getDate();
        const month = monthNamesFull[state.selectedDate.getMonth()].substring(0, 3);
        
        detailsHeader.textContent = `${day} ${month}.`;
        eventInput.placeholder = `Ajout Ã©vÃ©n. le ${day} ${month.toLowerCase()}.`;
        
        const tasksForDate = state.tasks.filter(task => task.dueDate === dateKey);
        
        if (tasksForDate.length === 0) {
          detailsContent.innerHTML = `
            <div class="empty-state">
              <div class="empty-icon">â˜º</div>
              <div class="empty-text">Appuyez pour ajouter un autocollant Ã  cette journÃ©e.</div>
            </div>
          `;
        } else {
          const taskListHTML = tasksForDate.map(task => `
            <div class="task-item">
              <div class="task-checkbox ${task.completed ? 'completed' : ''}" data-id="${task.id}"></div>
              <div class="task-info">
                <div class="task-title">${task.title}</div>
                ${task.tag ? `<div class="task-meta">${task.tag}</div>` : ''}
              </div>
              <div class="task-actions">
                <button class="task-action-btn delete" data-action="delete" data-id="${task.id}">Ã—</button>
              </div>
            </div>
          `).join('');
          
          detailsContent.innerHTML = `<div class="task-list">${taskListHTML}</div>`;
          
          detailsContent.querySelectorAll('.task-checkbox').forEach(checkbox => {
            checkbox.addEventListener('click', (e) => {
              const id = e.target.dataset.id;
              const task = state.tasks.find(t => t.id === id);
              if (task) {
                updateTask(id, { completed: !task.completed });
              }
            });
          });
          
          detailsContent.querySelectorAll('.task-action-btn.delete').forEach(btn => {
            btn.addEventListener('click', (e) => {
              const id = e.target.dataset.id;
              if (confirm('Delete this task?')) {
                deleteTask(id);
              }
            });
          });
        }
      };

      const changeMonth = (offset) => {
        state.currentMonth += offset;
        if (state.currentMonth < 0) {
          state.currentMonth = 11;
          state.currentYear -= 1;
        } else if (state.currentMonth > 11) {
          state.currentMonth = 0;
          state.currentYear += 1;
        }
        renderCalendar();
        renderDetails();
      };

      const updateCurrentDayBadge = () => {
        const today = new Date();
        const badge = document.getElementById('current-day-badge');
        badge.textContent = today.getDate();
      };

      document.getElementById('prev-month').addEventListener('click', () => changeMonth(-1));
      document.getElementById('next-month').addEventListener('click', () => changeMonth(1));
      
      document.getElementById('add-btn').addEventListener('click', () => {
        const input = document.getElementById('event-input');
        input.focus();
      });

      document.getElementById('event-input').addEventListener('keypress', (e) => {
        if (e.key === 'Enter' && e.target.value.trim()) {
          const title = e.target.value.trim();
          const dateKey = getDateKey(state.selectedDate);
          
          addTask({
            title: title,
            dueDate: dateKey,
            description: '',
            tag: '',
            completed: false,
          });
          
          e.target.value = '';
        }
      });

      document.getElementById('search-btn').addEventListener('click', () => {
        const today = new Date();
        state.currentYear = today.getFullYear();
        state.currentMonth = today.getMonth();
        state.selectedDate = today;
        renderCalendar();
        renderDetails();
      });

      const init = () => {
        state.tasks = loadTasks();
        state.selectedDate = new Date();
        updateCurrentDayBadge();
        renderCalendar();
        renderDetails();
      };

      init();
    </script>
  </body>
</html>
